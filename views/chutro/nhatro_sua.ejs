<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
	<script type="text/javascript" src="Scripts/jquery-2.1.1.min.js"></script>
	<link href="http://localhost:3000/css/dropzone.css" rel="stylesheet">
	<title><%= title %></title>
	<style>
			
	</style>
	
</head>

<body>
	<%- include('include/header') %>
    <div class="page-body">
        <%- include('include/sidebar') %>
        <div class="page-content-wrapper">
            <div class="page-content-wrapper-inner">
                <div class="content-viewport">
                <div class="row" >
                    <div class="col-12 py-5">
                        <div class="grid">
                            <p class="grid-header" style="box-shadow: 0px 5px 10px rgb(225, 225, 225);">ĐĂNG KÝ TRỌ</p>
                            <div class="item-wrapper row">
	
	  
	<div class="row">
		<div class=" col-7">
			<form action="/chutro/nhatro_sua/<%= nt.ID_NT %>" method="post"  class="needs-validation">
			<div class="card-body row">
				
				<!--Địa chỉ-->
				<div class="row border p-3 rounded m-0">
					<div style="margin-top: -29px;"><b style="background-color: white;">Địa chỉ</b></div>
					<div class="col-4">
						<label for="detail_address" class="form-label small">Tỉnh/Thành phố</label>
						<select name="province" id="province" class="form-select rounded-pill">
							<option></option>
							<% Provinces.forEach(function(pr){ %>
								<option value="<%= pr.id %>" <%= pr.id == nt.KhuVuc_NT ? 'selected' : '' %>><%= pr._name %></option>
							<% }); %>
						</select>
					</div>

					<div class="col-4">
						<label for="" class="form-label small">Quận/Huyện</label>
						<select name="district" id="district" class="form-select rounded-pill">
						</select>
					</div>

					<div class="col-4">
						<label for="" class="form-label small">Xã/Phường/Thị trấn</label>
						<select name="ward" id="ward" class="form-select rounded-pill">
						</select>
					</div>

					<div class="mt-3 col-12">
						<label for="" class="form-label small">Vị trí cụ thể</label>
						<input id="vtct" name="vtct" type="text"  class="rounded-pill form-control" placeholder="số nhà/đường, khóm, ấp,...">
					</div>
					<div class="mt-3 col-12">
						<label for="detail_address" class="form-label small">Địa chỉ đầy đủ</label>
						<input name="DiaChi_NT" id="detail_address" type="text" class="rounded-pill form-control" value="<%= nt.DiaChi_NT %>" readonly>
					</div>
				</div>

				<!--Thông tinh trọ-->
				<div class="row border p-3 rounded mt-3 m-0">
					<div style="margin-top: -29px;"><b style="background-color: white;">Thông tin</b></div>
					<div class="mt-3 col-6">
						<label for="" class="form-label small">Tên nhà trọ</label>
						<input id="TenNhaTro_NT" name="TenNhaTro_NT" type="text" class="rounded-pill form-control" value="<%= nt.TenNhaTro_NT %>" required>
					</div>
					<div class="mt-3 col-6">
						<label for="detail_address" class="form-label small">Số điện thoại trọ</label>
						<div class="input-group">
							<span class="input-group-text rounded-pill rounded-end">(+84)</span>
							<input name="SoDienThoai_NT" id="detail_address" type="number" class="rounded-pill form-control rounded-start" value="<%= nt.SoDienThoai_NT %>" required>
						</div>
					</div>
					<div class="mt-3 col-6">
						<label for="" class="form-label small">Giá</label>
						<input id="GiaNT" name="Gia_NT" type="number" class="rounded-pill form-control" value="<%= nt.Gia_NT %>" required>
					</div>
					<div class="mt-3 col-6">
						<label for="" class="form-label small">Số lượng phòng</label>
						<input id="SoLuongPhong_NT" name="SoLuongPhong_NT" type="number" class="rounded-pill form-control" value="<%= nt.SoLuongPhong_NT %>" required>
					</div>
					
				</div>

					<!-- Google map -->
					<div class="mt-4">
							<label for="" class="form-label">Để hiển thị bản đồ vui lòng nhập địa chọn đại chỉ trên bản đồ</label>
							<input id="searchInput" class="controls border-0" type="text" placeholder="Nhập địa chỉ như ở trên" style="width: 100%; height: 50px;">

							<!-- Google map -->
							<div id="map" style="height: 500px;"></div>	
							<!-- Display geolocation data -->
						<ul class="geo-data">
							<li>Full Address: <span id="location"></span></li>
							<li>Country: <span id="country"></span></li>
							<input id="lat" type="" class="m-3 form-control col-6" name="lat" value="<%= nt.Lat_NT %>">
							<input id="lng" type="" class="m-3 form-control col-6" name ="lng" value="<%= nt.Lng_NT %>">
						</ul>

					</div>

				</div>
			</div>


			<div class="col-md-5">
										
				<div class="mt-3 col-12">
					<label for="" class="form-label small">Thông tin mô tả</label>
					<textarea id="ThongTin_NT" name="ThongTin_NT" type="text" class="rounded-pill form-control ckeditor"><%= nt.ThongTin_NT %></textarea>
				</div>
				<!--Upload anh-->
				<div class="row border p-3 rounded mt-3 m-0">
					<div class="mt-3 col-6">
						<label for="" class="form-label small">Hình ảnh</label>
					</div>
					<div class="card-contain col-12">
						<div class="top">
						</div>
						<div class="drag-area">
							<span class="visible">
								Drag & drop image here or
								<span class="select" role="button">Browse</span>
							</span>
							<span class="on-drop">Drop images here</span>
							<input id="image" type="file" class="file" name="image"/>
						</div>
				
						<!-- IMAGE PREVIEW CONTAINER -->
						<div class="container"></div>
					</div>
					
				</div>
				<!--Tiện ích-->
				<div class="row border p-3 rounded mt-3 m-0">
					<div style="margin-top: -29px;"><b style="background-color: white;">Tiện ích</b></div>
					
						<div class=" row">
							<div class="col-6">
								<div class="form-check form-switch m-lg-2">
									<input class="form-check-input" type="checkbox" value="1" <%= nt.Wifi_NT == '1' ? 'checked' : '' %> name="Wifi_NT">
									<label class="form-check-label" for="flexSwitchCheckDefault">Wifi</label>
								</div>
								<div class="form-check form-switch m-lg-2">
									<input class="form-check-input" type="checkbox" value="1"  name="TV_NT" <%= nt.TV_NT == '1' ? 'checked' : '' %>>
									<label class="form-check-label" for="flexSwitchCheckDefault">TV</label>
								</div>
								<div class="form-check form-switch m-lg-2">
									<input class="form-check-input" type="checkbox" value="1" name="ChoDeXe_NT" <%= nt.ChoDeXe_NT == '1' ? 'checked' : '' %>>
									<label class="form-check-label" for="flexSwitchCheckDefault">Chỗ để xe</label>
								</div>
							</div>

							<div class="col-6">
								<div class="form-check form-switch m-lg-2">
									<input class="form-check-input" type="checkbox" value="1" name="TuLanh_NT" <%= nt.TuLanh_NT == '1' ? 'checked' : '' %>>
									<label class="form-check-label" for="flexSwitchCheckDefault">Tủ lạnh</label>
								</div>
								<div class="form-check form-switch m-lg-2">
									<input class="form-check-input" type="checkbox" value="1" name="MayLanh_NT" <%= nt.MayLanh_NT == '1' ? 'checked' : '' %>>
									<label class="form-check-label" for="flexSwitchCheckDefault">Máy lạnh</label>
								</div>
								<div class="form-check form-switch m-lg-2">
									<input class="form-check-input" type="checkbox" value="1" name="BepNauAn_NT" <%= nt.BepNauAn_NT == '1' ? 'checked' : '' %>>
									<label class="form-check-label" for="flexSwitchCheckDefault">Bếp nấu ăn</label>
								</div>
							</div>
						</div>
				</div>
				
				<div class="text-center">
					<button type="submit" class="btn btn-primary btn-block mb-4">Cập nhật</button>
				</div>
			</div>
			
		</form>
		
	
		<!-- Search input -->
		
	</div>
	</div>
</div>
</div>
</div>
</div>
</div>
</div>
	<%- include('include/dropzone'); %>
	<%- include('include/js'); %>
</body>

<%- include('include/javascript'); %>
<script>
	var val = 0;
	$('input.form-check-input').click(function(){
		if($(this).is(':checked')){
			$(this).val = 1;
		}
	});
</script>
<script src="https://cdn.ckeditor.com/4.18.0/full/ckeditor.js"></script>
<script>
	CKEDITOR.replace('ThongTin_NT', {
		customConfig: 'http://127.0.0.1:3000/js/config.js'
	});
</script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.1.1/basic.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.1.1/dropzone.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.1.1/dropzone.js"></script>

<script>

    //Preview image
    function readURL(input) {
        if (input.files && input.files[0]){
            var reader = new FileReader();

            reader.onload = function(e) {
                $("#imgPreview").attr('src', e.target.result).width(100).height(100);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#img").change(function() {
        readURL(this);
    });

    //Dropzone
    Dropzone.options.dropzoneForm = {
        acceptedFiles: "image/*",
        init: function() {
            this.on("queuecomplete", function(file) {
               setTimeout(function() {
                location.reload()
                }, 1000); 
            });
        }
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&key=AIzaSyBZR3F_2097P2SHZAQ3y3VrrcVxp_FBNTQ"></script>
<script>
var searchInput = 'search_input';
 
$(document).ready(function () {
	var autocomplete;
	autocomplete = new google.maps.places.Autocomplete((document.getElementById(searchInput)), {
	types: ['geocode'],
	})
	google.maps.event.addListener(autocomplete, 'place_changed', function () {
		var place = autocomplete.getPlace();
		jQuery('#lat').val(place.geometry.location.lat())
		jQuery('#lng').val(place.geometry.location.lng())
	});
});
</script>

<script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyB9TP02epbr3r0d1YWYlhK-u8i5JQW16_M&callback=initMap" async defer></script>
<script>
	function initMap() {
		var map = new google.maps.Map(document.getElementById('map'), {
		  center: {lat: -33.8688, lng: 151.2195},
		  zoom: 13
		});
		var input = document.getElementById('searchInput');
		map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
	
		var autocomplete = new google.maps.places.Autocomplete(input);
		autocomplete.bindTo('bounds', map);
	
		var infowindow = new google.maps.InfoWindow();
		var marker = new google.maps.Marker({
			map: map,
			anchorPoint: new google.maps.Point(0, -29)
		});
	
		autocomplete.addListener('place_changed', function() {
			infowindow.close();
			marker.setVisible(false);
			var place = autocomplete.getPlace();
			if (!place.geometry) {
				window.alert("Autocomplete's returned place contains no geometry");
				return;
			}
	  
			// If the place has a geometry, then present it on a map.
			if (place.geometry.viewport) {
				map.fitBounds(place.geometry.viewport);
			} else {
				map.setCenter(place.geometry.location);
				map.setZoom(17);
			}
			marker.setIcon(({
				url: place.icon,
				size: new google.maps.Size(71, 71),
				origin: new google.maps.Point(0, 0),
				anchor: new google.maps.Point(17, 34),
				scaledSize: new google.maps.Size(35, 35)
			}));
			marker.setPosition(place.geometry.location);
			marker.setVisible(true);
		
			var address = '';
			if (place.address_components) {
				address = [
				  (place.address_components[0] && place.address_components[0].short_name || ''),
				  (place.address_components[1] && place.address_components[1].short_name || ''),
				  (place.address_components[2] && place.address_components[2].short_name || '')
				].join(' ');
			}
		
			infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
			infowindow.open(map, marker);
		  
			// Location details
			for (var i = 0; i < place.address_components.length; i++) {
				if(place.address_components[i].types[0] == 'postal_code'){
					document.getElementById('postal_code').innerHTML = place.address_components[i].long_name;
				}
				if(place.address_components[i].types[0] == 'country'){
					document.getElementById('country').innerHTML = place.address_components[i].long_name;
				}
			}
			document.getElementById('location').innerHTML = place.formatted_address;
			document.getElementById('lat').value = place.geometry.location.lat();
			document.getElementById('lng').value = place.geometry.location.lng();
		});
	}
	</script>
</html>